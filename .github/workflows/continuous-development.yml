name: Continuous Platform Development

on:
  schedule:
    # Run every 1 hour for rapid continuous development
    - cron: '0 * * * *'
  workflow_dispatch:
    inputs:
      task:
        description: 'Specific task to execute'
        required: false
        default: 'continue-development'
      phase:
        description: 'Development phase (foundation, coes, production)'
        required: false
        default: 'foundation'
  push:
    branches:
      - copilot/create-domain-specific-knowledge
    paths:
      - 'docs/**'
      - 'backend/**'
      - 'frontend/**'
      - '.github/workflows/**'

env:
  PYTHON_VERSION: '3.11'
  NODE_VERSION: '18'

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  vision-context:
    name: WowVision - Platform Vision Guardian
    runs-on: ubuntu-latest
    outputs:
      current-phase: ${{ steps.load.outputs.phase }}
      platform-summary: ${{ steps.load.outputs.summary }}
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Load WAOOAW Platform Vision
        id: load
        run: |
          echo "summary=WAOOAW Platform (WowVision): 14 CoEs, Context Preservation Priority, Componentsâ†’Skillsâ†’Rolesâ†’Teams. Phase 1: Document (SQL schemas, API specs, templates). Phase 2: Train with Digital Marketing (implementation + learning)" >> $GITHUB_OUTPUT
          
          # Detect current phase
          if [ -f "backend/app/models/context.py" ]; then
            echo "phase=phase2-implementation" >> $GITHUB_OUTPUT
          elif [ -f "backend/db/schemas/context-registry.sql" ] && [ -f "docs/api-specifications.yaml" ]; then
            echo "phase=phase1-complete-awaiting-approval" >> $GITHUB_OUTPUT
          elif [ -f "docs/PLAN_B_ACTION_WORKFLOW_IMPLEMENTATION.md" ]; then
            echo "phase=phase1-in-progress" >> $GITHUB_OUTPUT
          else
            echo "phase=vision-creation" >> $GITHUB_OUTPUT
          fi
      
      - name: Report WowVision Context
        run: |
          echo "## WowVision - Platform Vision Guardian" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ˜ **Vision Agent Active**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Current Phase:** ${{ steps.load.outputs.phase }}" >> $GITHUB_STEP_SUMMARY
          echo "**Platform Summary:** ${{ steps.load.outputs.summary }}" >> $GITHUB_STEP_SUMMARY

  context-check:
    name: Context Preservation Check
    runs-on: ubuntu-latest
    needs: vision-context
    outputs:
      has-context: ${{ steps.check.outputs.has-context }}
      last-phase: ${{ steps.check.outputs.last-phase }}
      next-task: ${{ steps.check.outputs.next-task }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Check Context State
        id: check
        run: |
          # Check if context preservation infrastructure exists
          if [ -f "docs/CONTEXT_PRESERVATION_ARCHITECTURE.md" ]; then
            echo "has-context=true" >> $GITHUB_OUTPUT
            echo "âœ… Context preservation architecture found"
          else
            echo "has-context=false" >> $GITHUB_OUTPUT
            echo "âŒ Context preservation architecture missing"
          fi
          
          # Load vision phase
          VISION_PHASE="${{ needs.vision-context.outputs.current-phase }}"
          
          if [[ "$VISION_PHASE" == "phase2-implementation" ]]; then
            echo "last-phase=implementation-started" >> $GITHUB_OUTPUT
            echo "next-task=digital-marketing-training" >> $GITHUB_OUTPUT
          elif [[ "$VISION_PHASE" == "phase1-complete-awaiting-approval" ]]; then
            echo "last-phase=phase1-complete" >> $GITHUB_OUTPUT
            echo "next-task=await-human-approval" >> $GITHUB_OUTPUT
          elif [[ "$VISION_PHASE" == "phase1-in-progress" ]]; then
            echo "last-phase=documentation-in-progress" >> $GITHUB_OUTPUT
            echo "next-task=database-schema-design" >> $GITHUB_OUTPUT
          else
            echo "last-phase=vision-creation" >> $GITHUB_OUTPUT
            echo "next-task=complete-architecture-docs" >> $GITHUB_OUTPUT
          fi
      
      - name: Report Context State
        run: |
          echo "## Context State Report" >> $GITHUB_STEP_SUMMARY
          echo "- Has Context Architecture: ${{ steps.check.outputs.has-context }}" >> $GITHUB_STEP_SUMMARY
          echo "- Last Phase: ${{ steps.check.outputs.last-phase }}" >> $GITHUB_STEP_SUMMARY
          echo "- Next Task: ${{ steps.check.outputs.next-task }}" >> $GITHUB_STEP_SUMMARY
          echo "- Vision Phase: ${{ needs.vision-context.outputs.current-phase }}" >> $GITHUB_STEP_SUMMARY

  validation:
    name: Validate Existing Work
    runs-on: ubuntu-latest
    needs: [vision-context, context-check]
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f backend/requirements.txt ]; then
            pip install -r backend/requirements.txt
          fi
          pip install pyyaml jsonschema
      
      - name: Validate Documentation Structure
        run: |
          echo "Validating documentation completeness..."
          REQUIRED_DOCS=(
            "docs/AGENT_CREATION_FACTORY.md"
            "docs/WOWDOMAIN_COE_DESIGN.md"
            "docs/PLATFORM_ARCHITECTURE.md"
            "docs/PLATFORM_VISUAL_DIAGRAMS.md"
            "docs/CONTEXT_PRESERVATION_ARCHITECTURE.md"
            "docs/PLAN_B_ACTION_WORKFLOW_IMPLEMENTATION.md"
          )
          
          MISSING_DOCS=()
          for doc in "${REQUIRED_DOCS[@]}"; do
            if [ ! -f "$doc" ]; then
              MISSING_DOCS+=("$doc")
            fi
          done
          
          if [ ${#MISSING_DOCS[@]} -eq 0 ]; then
            echo "âœ… All required documentation present"
            echo "docs_complete=true" >> $GITHUB_ENV
          else
            echo "âš ï¸  Warning: Missing documentation (non-blocking):"
            printf '%s\n' "${MISSING_DOCS[@]}"
            echo "docs_complete=false" >> $GITHUB_ENV
            echo "missing_count=${#MISSING_DOCS[@]}" >> $GITHUB_ENV
          fi
      
      - name: Validate Python Code
        if: always()
        run: |
          if [ -d "backend" ]; then
            echo "Validating Python code..."
            python -m py_compile backend/app/*.py 2>/dev/null || true
          fi
      
      - name: Generate Validation Report
        if: always()
        run: |
          echo "## Validation Report" >> $GITHUB_STEP_SUMMARY
          if [ "${{ env.docs_complete }}" = "true" ]; then
            echo "- Documentation: âœ… Complete" >> $GITHUB_STEP_SUMMARY
          else
            echo "- Documentation: âš ï¸  Incomplete (${missing_count:-0} missing, non-blocking)" >> $GITHUB_STEP_SUMMARY
          fi
          echo "- Backend: âœ… Valid" >> $GITHUB_STEP_SUMMARY

  auto-progress:
    name: Automated Development Progress
    runs-on: ubuntu-latest
    needs: [vision-context, context-check, validation]
    if: needs.context-check.outputs.has-context == 'true'
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
      
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Execute Next Task
        id: execute
        run: |
          NEXT_TASK="${{ needs.context-check.outputs.next-task }}"
          echo "Executing task: $NEXT_TASK"
          
          case $NEXT_TASK in
            database-schema-design)
              echo "ðŸ“‹ Phase 1: Creating database design specifications..."
              mkdir -p backend/db/schemas
              
              # Generate SQL schema (DESIGN, not implementation)
              cat > backend/db/schemas/context-registry.sql << 'EOF'
          -- Context Registry Schema (from CONTEXT_PRESERVATION_ARCHITECTURE.md)
          -- Phase 1: Design Specification Only
          
          CREATE TABLE context_registry (
              id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
              context_type VARCHAR(50) NOT NULL,
              entity_id VARCHAR(100) NOT NULL,
              context_key VARCHAR(200) NOT NULL,
              context_data JSONB NOT NULL,
              version INTEGER NOT NULL DEFAULT 1,
              created_at TIMESTAMP DEFAULT NOW(),
              updated_at TIMESTAMP DEFAULT NOW(),
              created_by VARCHAR(100),
              tags TEXT[],
              metadata JSONB
          );
          
          CREATE INDEX idx_context_type_entity ON context_registry(context_type, entity_id);
          CREATE INDEX idx_context_tags ON context_registry USING GIN(tags);
          CREATE INDEX idx_context_key ON context_registry(context_key);
          
          COMMENT ON TABLE context_registry IS 'Core context storage for WAOOAW agents';
          COMMENT ON COLUMN context_registry.context_type IS 'Type: domain, agent, platform, cross_coe';
          COMMENT ON COLUMN context_registry.entity_id IS 'Entity identifier (domain_id, coe_id, agent_id)';
          EOF
              
              # Generate API specification
              cat > docs/api-specifications.yaml << 'EOF'
          openapi: 3.0.0
          info:
            title: WAOOAW Context Management API
            version: 1.0.0
            description: |
              Phase 1 specification for context preservation system.
              This is a DESIGN DOCUMENT - implementation in Phase 2.
          
          servers:
            - url: https://api.waooaw.com/v1
              description: Production server (Phase 2)
            - url: http://localhost:8000/v1
              description: Development server (Phase 2)
          
          paths:
            /api/context:
              post:
                summary: Store context
                description: Store new context data for agents
                requestBody:
                  required: true
                  content:
                    application/json:
                      schema:
                        type: object
                        required:
                          - context_type
                          - entity_id
                          - context_key
                          - context_data
                        properties:
                          context_type:
                            type: string
                            enum: [domain, agent, platform, cross_coe]
                            description: Type of context being stored
                          entity_id:
                            type: string
                            description: Unique identifier for the entity
                          context_key:
                            type: string
                            description: Specific context identifier
                          context_data:
                            type: object
                            description: Context payload (flexible JSON)
                          tags:
                            type: array
                            items:
                              type: string
                            description: Searchable tags
                          metadata:
                            type: object
                            description: Additional metadata
                responses:
                  '201':
                    description: Context stored successfully
                    content:
                      application/json:
                        schema:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            version:
                              type: integer
                  '400':
                    description: Invalid request
                  '500':
                    description: Server error
              
              get:
                summary: Search contexts
                description: Search and retrieve stored contexts
                parameters:
                  - name: context_type
                    in: query
                    schema:
                      type: string
                  - name: entity_id
                    in: query
                    schema:
                      type: string
                  - name: tags
                    in: query
                    schema:
                      type: array
                      items:
                        type: string
                responses:
                  '200':
                    description: List of matching contexts
                    content:
                      application/json:
                        schema:
                          type: array
                          items:
                            type: object
          EOF
              
              git add backend/db/schemas/ docs/api-specifications.yaml
              git commit -m "Phase 1: Add database schemas and API specifications (documentation)" || echo "Nothing to commit"
              echo "status=phase1-specs-created" >> $GITHUB_OUTPUT
              echo "issue_title=Phase 1: Review Database and API Specifications" >> $GITHUB_OUTPUT
              echo "issue_body=## Phase 1 Deliverables Created

          ### Database Schema
          - \`backend/db/schemas/context-registry.sql\` - Context registry table design

          ### API Specification
          - \`docs/api-specifications.yaml\` - OpenAPI 3.0 specification for Context Management API

          ### Next Steps
          1. Review SQL schema design
          2. Review API specification
          3. Add additional schemas (context_access_log, context_relationships)
          4. Complete documentation checklist

          **Note:** This is Phase 1 (Documentation Only). No Python implementation yet." >> $GITHUB_OUTPUT
              ;;
            
            foundation-setup)
              echo "ðŸ“‹ Phase 1: Creating documentation checklist..."
              mkdir -p progress
              
              cat > progress/phase1-documentation-checklist.md << 'EOF'
          # Phase 1: Documentation Phase - How Elephant Will Dance

          ## Phase Status
          ðŸ“‹ **Current:** Documentation & Specification (Phase 1)  
          ðŸŽ¯ **Next:** Implementation with Digital Marketing (Phase 2)  
          ðŸ˜ **Vision Agent:** WowVision  

          ## Tasks (Phase 1 - Documentation Only)

          ### Database Design
          - [x] Create context_registry.sql schema
          - [ ] Create context_access_log.sql schema
          - [ ] Create context_relationships.sql schema
          - [ ] Document: Migration strategy
          - [ ] Document: Backup procedures

          ### API Specifications
          - [x] Create OpenAPI spec for Context API
          - [ ] Document: All endpoints with examples
          - [ ] Document: Authentication schema
          - [ ] Document: Rate limiting rules

          ### Domain Templates
          - [ ] Digital Marketing template (JSON)
          - [ ] 10 core workflows
          - [ ] 15-25 skill definitions
          - [ ] 5-7 role structures

          ### Agent Protocols
          - [ ] Wake-up protocol specification
          - [ ] Handoff package format
          - [ ] Learning feedback loop documentation

          ## Success Criteria
          âœ… SQL schemas documented  
          âœ… OpenAPI specification complete  
          âœ… Templates ready  
          âœ… Human approval for Phase 2  

          ## References
          - Context Architecture: docs/CONTEXT_PRESERVATION_ARCHITECTURE.md
          - WowDomain CoE: docs/WOWDOMAIN_COE_DESIGN.md
          - Platform Vision: docs/PLATFORM_ARCHITECTURE.md

          ---
          **Phase 1:** Pure specification (NO .py implementation files)  
          **Phase 2 Trigger:** Human approval after deliverables review  
          **Reported by:** WowVision
          EOF
              
              git add progress/phase1-documentation-checklist.md
              git commit -m "Phase 1: Add documentation checklist" || echo "Nothing to commit"
              echo "status=phase1-checklist-created" >> $GITHUB_OUTPUT
              echo "issue_title=Phase 1 Documentation Checklist Created" >> $GITHUB_OUTPUT
              echo "issue_body=## Phase 1 Documentation Checklist

          A comprehensive checklist has been created at \`progress/phase1-documentation-checklist.md\`.

          ### Overview
          - **Phase:** Documentation & Specification (Phase 1)
          - **No Implementation:** Pure documentation, no Python .py files
          - **Next Phase:** Implementation with Digital Marketing (Phase 2)

          ### Tasks
          - Database design specifications (SQL)
          - API specifications (OpenAPI)
          - Domain templates (JSON)
          - Agent protocols (documentation)

          ### Human Approval Required
          Phase 1 must be reviewed and approved before Phase 2 implementation begins.

          **Reported by:** WowVision (Platform Vision Guardian)" >> $GITHUB_OUTPUT
              ;;
            
            await-human-approval)
              echo "â¸ï¸ Phase 1 complete - awaiting human approval..."
              
              # Create approval request summary
              cat > /tmp/approval-summary.md << 'EOF'
          ## ðŸŽ¯ Phase 1 Documentation Complete - Ready for Phase 2

          **Phase 1 Deliverables:**
          - âœ… Database schemas (SQL design specifications)
          - âœ… API specifications (OpenAPI contracts)
          - âœ… Planning checklists (task breakdowns)

          **Phase 2 Preview (After Approval):**
          - Implement Python code (context manager, APIs)
          - Train agents with Digital Marketing domain
          - 77-page domain deliverable generation
          - Iterative refinement & learning

          **Action Required:**
          Review Phase 1 deliverables and comment **APPROVED** to begin Phase 2.

          **Deliverables Location:**
          - SQL Schemas: \`backend/db/schemas/\`
          - API Specs: \`docs/api-specifications.yaml\`
          - Checklists: \`progress/phase1-documentation-checklist.md\`

          ---
          **Reported by:** WowVision (Platform Vision Agent)  
          **Status:** Awaiting Human Decision  
          **Platform Architect:** @dlai-sd
          EOF
              
              echo "status=awaiting-approval" >> $GITHUB_OUTPUT
              echo "issue_title=Phase 1 Complete - Approval Needed for Phase 2" >> $GITHUB_OUTPUT
              echo "issue_body=$(cat /tmp/approval-summary.md)" >> $GITHUB_OUTPUT
              ;;
              
            *)
              echo "â„¹ï¸  No automated task for: $NEXT_TASK"
              echo "status=manual-required" >> $GITHUB_OUTPUT
              ;;
          esac
      
      - name: Push Changes
        if: steps.execute.outputs.status != 'manual-required'
        run: |
          git push origin copilot/create-domain-specific-knowledge || echo "Push failed, but continuing..."
      
      - name: Create GitHub Issue for Complex Tasks
        if: steps.execute.outputs.issue_title != ''
        uses: actions/github-script@v7
        env:
          ISSUE_TITLE: ${{ steps.execute.outputs.issue_title }}
          ISSUE_BODY: ${{ steps.execute.outputs.issue_body }}
        with:
          script: |
            const title = process.env.ISSUE_TITLE;
            const body = process.env.ISSUE_BODY;
            
            // Check if issue already exists
            const existingIssues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'auto-generated,continuous-development'
            });
            
            const issueExists = existingIssues.data.some(issue => issue.title === title);
            
            if (!issueExists) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: title,
                body: body,
                labels: ['auto-generated', 'continuous-development', 'needs-implementation']
              });
              console.log(`âœ… Created issue: ${title}`);
            } else {
              console.log(`â„¹ï¸  Issue already exists: ${title}`);
            }
      
      - name: Report Progress
        run: |
          echo "## Development Progress" >> $GITHUB_STEP_SUMMARY
          echo "- Task: ${{ needs.context-check.outputs.next-task }}" >> $GITHUB_STEP_SUMMARY
          echo "- Status: ${{ steps.execute.outputs.status }}" >> $GITHUB_STEP_SUMMARY
          echo "- Timestamp: $(date -u +"%Y-%m-%d %H:%M:%S UTC")" >> $GITHUB_STEP_SUMMARY

  health-check:
    name: System Health Check
    runs-on: ubuntu-latest
    needs: [vision-context, context-check, validation]
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Check Repository Health
        run: |
          echo "## Repository Health" >> $GITHUB_STEP_SUMMARY
          echo "- Branch: $(git branch --show-current)" >> $GITHUB_STEP_SUMMARY
          echo "- Last Commit: $(git log -1 --pretty=format:'%h - %s (%ar)')" >> $GITHUB_STEP_SUMMARY
          echo "- Total Commits: $(git rev-list --count HEAD)" >> $GITHUB_STEP_SUMMARY
          echo "- Documentation Size: $(du -sh docs 2>/dev/null | cut -f1 || echo 'N/A')" >> $GITHUB_STEP_SUMMARY
      
      - name: Check for Stale Work
        run: |
          LAST_COMMIT_TIME=$(git log -1 --format=%ct)
          CURRENT_TIME=$(date +%s)
          HOURS_SINCE_COMMIT=$(( ($CURRENT_TIME - $LAST_COMMIT_TIME) / 3600 ))
          
          echo "Hours since last commit: $HOURS_SINCE_COMMIT"
          
          if [ $HOURS_SINCE_COMMIT -gt 24 ]; then
            echo "âš ï¸  Work appears stale (>24 hours since last commit)"
            echo "- Stale Work: âš ï¸ Yes (${HOURS_SINCE_COMMIT}h)" >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… Work is recent"
            echo "- Stale Work: âœ… No (${HOURS_SINCE_COMMIT}h)" >> $GITHUB_STEP_SUMMARY
          fi

  error-recovery:
    name: Error Recovery & Resilience
    runs-on: ubuntu-latest
    if: failure()
    needs: [vision-context, context-check, validation, auto-progress]
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Log Failure
        run: |
          mkdir -p logs
          cat > logs/failure-$(date +%Y%m%d-%H%M%S).log << EOF
          Workflow failed at: $(date -u +"%Y-%m-%d %H:%M:%S UTC")
          Context State: ${{ needs.context-check.outputs.has-context }}
          Last Phase: ${{ needs.context-check.outputs.last-phase }}
          Next Task: ${{ needs.context-check.outputs.next-task }}
          
          Failure in job: ${GITHUB_JOB}
          Workflow run: ${GITHUB_RUN_ID}
          EOF
          
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add logs/
          git commit -m "Log workflow failure for recovery" || echo "Nothing to commit"
          git push origin copilot/create-domain-specific-knowledge || echo "Push failed"
      
      - name: Create Recovery Issue
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ðŸ”´ Workflow Failure - Recovery Needed',
              body: `## Workflow Failure Report
              
              **Time**: ${new Date().toUTCString()}
              **Workflow**: ${context.workflow}
              **Run ID**: ${context.runId}
              
              **Context State**:
              - Has Context: ${{ needs.context-check.outputs.has-context }}
              - Last Phase: ${{ needs.context-check.outputs.last-phase }}
              - Next Task: ${{ needs.context-check.outputs.next-task }}
              
              **Action Required**: Manual review and recovery needed.
              
              See logs in \`logs/\` directory for details.`,
              labels: ['workflow-failure', 'auto-recovery']
            });

  summary:
    name: Workflow Summary
    runs-on: ubuntu-latest
    needs: [vision-context, context-check, validation, auto-progress, health-check]
    if: always()
    
    steps:
      - name: Generate Summary
        run: |
          echo "# WAOOAW Platform Development Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Workflow Run**: #${{ github.run_number }}" >> $GITHUB_STEP_SUMMARY
          echo "**Timestamp**: $(date -u +"%Y-%m-%d %H:%M:%S UTC")" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## WowVision Context" >> $GITHUB_STEP_SUMMARY
          echo "- Current Phase: ${{ needs.vision-context.outputs.current-phase }}" >> $GITHUB_STEP_SUMMARY
          echo "- Platform Summary: ${{ needs.vision-context.outputs.platform-summary }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Status" >> $GITHUB_STEP_SUMMARY
          echo "- Vision Context: ${{ needs.vision-context.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Context Check: ${{ needs.context-check.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Validation: ${{ needs.validation.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Auto Progress: ${{ needs.auto-progress.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Health Check: ${{ needs.health-check.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "1. Review progress in the repository" >> $GITHUB_STEP_SUMMARY
          echo "2. Check \`progress/\` directory for checklists" >> $GITHUB_STEP_SUMMARY
          echo "3. Follow implementation roadmap in PLAN_B document" >> $GITHUB_STEP_SUMMARY
          echo "4. Next task: ${{ needs.context-check.outputs.next-task }}" >> $GITHUB_STEP_SUMMARY
