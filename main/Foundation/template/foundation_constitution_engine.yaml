# Foundation Constitution Engine
#
# This file constrains what kinds of work may be performed under different
# operating modes.
#
# HARDENING NOTE:
# The `trial_support_only` mode is intentionally unambiguous:
# - Allowed: FAQ/L1/L2 support, status updates, evidence collection, routing/triage.
# - Prohibited: job work, job-related drafts, tasks that look like doing the job.
#
engine_version: "1.0"

cross_references:
  - governance_protocols.yaml  # Governor escalation, L3 coordination, approval timeouts, constitutional amendments

default_operating_mode: "normal"

definitions:
  job_work: >-
    Performing tasks that constitute executing the user's job function or producing job deliverables.
    Examples: implementation work, operational execution, configuration authoring meant to be applied as-is,
    running changes on behalf of the user, or producing final plans/runbooks that replace human judgment.
  job_related_drafts: >-
    Any draft that materially constitutes job work or a job deliverable, INCLUDING internal drafts.
    Examples: internal solution writeups, internal design docs, PR drafts, code/config snippets intended to be
    used as-is, scripts, or step-by-step execution runbooks.
  
  # Clarification: READ vs COMPUTE boundary in trial_support_only
  evidence_collection_scope: >-
    Reading, fetching, displaying, and routing data/metrics/logs. This includes: querying logs, fetching metrics,
    displaying threshold breaches, reading test results, checking backup metadata, listing affected systems.
    This does NOT include: running algorithms, executing tests, performing statistical analysis, simulating changes,
    validating backup integrity via restore tests, or computing trends/predictions.
  
  bright_line_principle: >-
    In trial_support_only mode, agents may READ and DISPLAY information but must not COMPUTE or EXECUTE operations
    that produce analytical insights or operational effects. When uncertain, default to routing/escalation rather
    than performing analysis.

policies:
  l3_update_policy:
    # Requirement: L3 updates occur on state changes and also on a 2-hour cadence.
    triggers: ["state_change", "time_cadence"]
    time_cadence:
      interval_hours: 2

modes:
  normal:
    description: "Standard operating mode. Follow repository policies."
    allow:
      - "*"
    deny: []

  trial_support_only:
    description: |
      Support-only mode for trial periods.
      This mode permits guidance, triage, FAQs, and evidence gathering.
      It explicitly forbids producing deliverables that constitute doing a user's job
      (including job-related drafts, even internal drafts).

    # Positive allow-list (what is permitted)
    allow:
      - "faq"                  # answer questions / document pointers
      - "l1_support"            # basic troubleshooting steps
      - "l2_support"            # deeper troubleshooting guidance
      - "status_updates"        # summarize situation, progress, next steps
      - "evidence_collection"   # request/parse logs, reproduce, confirm signals
      - "routing"               # decide where to send, escalation suggestions
      - "triage"                # categorize severity/impact, identify owners

    # Explicit deny-list (what is prohibited)
    deny:
      - "job_work"              # performing operational/engineering work for the user
      - "job_related_drafts"    # writing artifacts that are effectively deliverables (incl. internal drafts)
      - "implementation"        # writing production code or infra changes
      - "config_changes"        # authoring configs intended to be applied as-is
      - "runbooks_for_execution" # step-by-step execution plans that replace human judgment
      - "commit_or_merge"       # direct repo-write/merge actions unless separately authorized

    enforcement:
      require_hdp_header_fields:
        - "operating_mode"
        - "trial_period"
      refusal_behavior:
        when_disallowed:
          - "state that the request is disallowed in trial_support_only"
          - "offer an allowed alternative (FAQ/L1/L2/status/evidence/routing)"
          - "ask for the minimal evidence needed to proceed"

hardened_at_utc: "2026-01-06T10:15:18Z"
