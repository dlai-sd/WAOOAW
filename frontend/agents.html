<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agents - WAOOAW Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0a0a0a; color: #fff; min-height: 100vh; }
        .header { background: #18181b; border-bottom: 1px solid #27272a; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 800; background: linear-gradient(135deg, #00f2fe, #667eea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav { display: flex; gap: 1rem; }
        .nav a { color: #a1a1aa; text-decoration: none; padding: 0.5rem 1rem; border-radius: 8px; }
        .nav a:hover, .nav a.active { background: #27272a; color: #fff; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        h1 { margin-bottom: 2rem; }
        .agents-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .agent-card { background: #18181b; border: 1px solid #27272a; border-radius: 16px; padding: 1.5rem; transition: all 0.3s ease; }
        .agent-card:hover { transform: translateY(-4px); border-color: #00f2fe; box-shadow: 0 0 20px rgba(0, 242, 254, 0.2); }
        .agent-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .agent-avatar { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 18px; }
        .agent-info { flex: 1; }
        .agent-status-badge { display: inline-flex; align-items: center; padding: 4px 8px; border-radius: 6px; font-size: 12px; }
        .agent-status-badge.online { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .agent-status-badge.offline { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
        .agent-status-dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 6px; }
        .agent-status-badge.online .agent-status-dot { background: #10b981; }
        .agent-status-badge.offline .agent-status-dot { background: #ef4444; }
        .agent-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .agent-type { color: #a1a1aa; font-size: 13px; }
        .agent-meta { display: flex; justify-content: space-between; padding-top: 1rem; border-top: 1px solid #27272a; font-size: 13px; }
        .agent-meta span:first-child { color: #71717a; }
        .loading { text-align: center; padding: 4rem; color: #a1a1aa; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">WAOOAW</div>
        <div class="nav">
            <a href="/portal.html">Dashboard</a>
            <a href="/agents.html" class="active">Agents</a>
            <a href="/events.html">Events</a>
            <a href="/metrics.html">Metrics</a>
            <a href="/logs.html">Logs</a>
        </div>
    </div>
    <div class="container">
        <h1>ü§ñ Agents</h1>
        <div id="agentsGrid" class="agents-grid">
            <div class="loading">Loading agents...</div>
        </div>
    </div>
    <script>
        // Check if page is in Simple Browser that doesn't execute JS
        const isSimpleBrowser = window.location.href.includes('app.github.dev');
        
        const API_BASE = window.location.hostname.includes('app.github.dev') 
            ? `https://${window.location.hostname.replace('-3000', '-8000')}` 
            : 'http://localhost:8000';
        
        async function loadAgents() {
            try {
                console.log('Fetching agents from:', API_BASE);
                const res = await fetch(`${API_BASE}/api/platform/agents`);
                
                const data = await res.json();
                console.log('Received data:', data);
                
                const grid = document.getElementById('agentsGrid');
                
                // Handle registry errors gracefully
                if (data.error) {
                    grid.innerHTML = `
                        <div style="grid-column: 1 / -1; background: #18181b; border: 2px solid #ef4444; border-radius: 16px; padding: 2rem;">
                            <div style="font-size: 48px; text-align: center; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                            <h2 style="color: #ef4444; text-align: center; margin-bottom: 1rem;">${data.error}</h2>
                            <p style="color: #a1a1aa; text-align: center; margin-bottom: 1.5rem;">${data.message}</p>
                            ${data.suggestions ? `
                                <div style="background: #27272a; padding: 1.5rem; border-radius: 12px; margin-top: 1rem;">
                                    <h3 style="color: #fff; margin-bottom: 1rem;">üí° Suggested Actions:</h3>
                                    <ul style="color: #a1a1aa; line-height: 2;">
                                        ${data.suggestions.map(s => `<li>${s}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    return;
                }
                
                // Handle empty registry
                if (!data.agents || data.agents.length === 0) {
                    grid.innerHTML = `
                        <div style="grid-column: 1 / -1; background: #18181b; border: 2px solid #f59e0b; border-radius: 16px; padding: 2rem; text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                            <h2 style="color: #f59e0b; margin-bottom: 1rem;">No Agents Registered</h2>
                            <p style="color: #a1a1aa;">${data.warning || 'Registry is empty.'}</p>
                        </div>
                    `;
                    return;
                }
                
                const gradients = [
                    'linear-gradient(135deg, #667eea, #764ba2)',
                    'linear-gradient(135deg, #00f2fe, #4facfe)',
                    'linear-gradient(135deg, #f093fb, #f5576c)',
                    'linear-gradient(135deg, #ffa751, #ffe259)',
                ];
                
                // Show data source note
                let html = '';
                if (data.note) {
                    html += `
                        <div style="grid-column: 1 / -1; background: #18181b; border-left: 4px solid #3b82f6; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <strong style="color: #3b82f6;">‚ÑπÔ∏è Note:</strong> <span style="color: #a1a1aa;">${data.note}</span>
                        </div>
                    `;
                }
                
                html += data.agents.map((agent, index) => {
                    const initials = agent.name.split(/(?=[A-Z])/).map(w => w[0]).join('').substring(0, 2).toUpperCase();
                    const gradient = gradients[index % gradients.length];
                    
                    // Map registry status to display
                    const statusInfo = {
                        'registered': { badge: 'online', dot: '#10b981', label: '‚úì Registered' },
                        'draft': { badge: 'offline', dot: '#6b7280', label: 'üìù Draft' },
                        'provisioned': { badge: 'online', dot: '#3b82f6', label: 'üîß Provisioned' },
                        'suspended': { badge: 'offline', dot: '#f59e0b', label: '‚è∏ Suspended' },
                        'revoked': { badge: 'offline', dot: '#ef4444', label: '‚ùå Revoked' },
                        'unknown': { badge: 'offline', dot: '#6b7280', label: '? Unknown' }
                    };
                    
                    const status = statusInfo[agent.registry_status] || statusInfo['unknown'];
                    const metaNote = agent.metadata_source === 'static_registry' ? 'üìã Static metadata' : 'Dynamic';
                    
                    return `
                        <div class="agent-card">
                            <div class="agent-header">
                                <div class="agent-avatar" style="background: ${gradient};">${initials}</div>
                                <div class="agent-info">
                                    <div class="agent-name">${agent.name}</div>
                                    <span class="agent-status-badge ${status.badge}">
                                        <span class="agent-status-dot"></span>${status.label}
                                    </span>
                                </div>
                            </div>
                            <div class="agent-type">${agent.type.toUpperCase()} ‚Ä¢ Tier ${agent.tier}</div>
                            <div class="agent-meta">
                                <span>Version</span>
                                <span>v${agent.version}</span>
                            </div>
                            <div class="agent-meta">
                                <span>Source</span>
                                <span style="font-size: 11px;">${metaNote}</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                grid.innerHTML = html;
            } catch (e) {
                console.error('Failed to load agents:', e);
                document.getElementById('agentsGrid').innerHTML = 
                    `<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; background: #18181b; border-radius: 16px; border: 2px solid #ef4444;">
                        <div style="font-size: 48px; margin-bottom: 1rem;">‚ùå</div>
                        <h2 style="color: #ef4444; margin-bottom: 0.5rem;">Failed to Load Agents</h2>
                        <p style="color: #a1a1aa;">${e.message}</p>
                    </div>`;
            }
        }
        
        // Run on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadAgents);
        } else {
            loadAgents();
        }
    </script>
</body>
</html>
